，# Google Cloud x Gemini API を用いた Web 技術学習支援アプリの開発

# はじめに

[AI Agent Hackathon with Google Cloud](https://zenn.dev/hackathons/2024-google-cloud-japan-ai-hackathon) に参加するために、Google Cloud x Gemini API を用いた Web 技術学習支援システム「WebTech 道場」を開発しました。

本記事では、「WebTech 道場」の開発背景、機能概要、技術的な詳細、そして今後の展望についてご紹介します。

ソースコードはこちらで公開しています
https://github.com/empelt/web-tech-dojo

# アプリ概要

Web に関する問題を一覧から選んで回答すると、AI が理解が浅そうだと判断した箇所について深堀の質問をしてくれます。

画像は後で変える
![](https://storage.googleapis.com/zenn-user-upload/f162a298737a-20250209.png)

## デモ動画

実際にアプリを使用している様子を紹介しています。

[YouTube 動画]

# 対象とするユーザー像と課題

変化の激しい Web の領域でエンジニアとして働くためには、日々新しい技術を学び続ける必要があります。しかし、従来の学習方法では、以下のような課題がありました。

### 課題１：技術書で勉強して理解したつもりになっている

私たちエンジニアは技術を学ぶ際おもに、技術書、技術ブログ、動画コンテンツ等で知識のインプットを行うと思います。
しかし、一度学習をして理解した気になっていても、いざ人に説明するときに上手く言葉にできないという経験がある方も多いと思います。

### 課題２：効率的な勉強ができていない

何かよくわからないけどなかなか理解できない、みたいなことあると思います。これはもしかしたあら前提となる知識が足りていないのかもしれません。例えば HTTP をしっかり理解していないまま XSS の勉強をしてもそれは効率が悪いはずです。

### 課題３：次に何を勉強をすればいいのかわからない

ダッシュボード機能で自分がどの領域に弱いのかみたいなのがわかる的なことを言いたい。

### ターゲットユーザー

上記の課題から、ターゲットユーザーは以下を想定しています。

- Web に関する知識を増やしたい初心者
- 理解度の確認や苦手分野の把握をしたい Web エンジニア

また今回の開発にあたって一番大切にしていたのは、「自分がこのアプリを今後も使いたいと思うか」です。つまり一番のターゲットユーザーは自分です。

## ソリューションと特徴

先ほど挙げた課題に対するソリューションと、それを実現するアプリの特徴を説明します。

### 課題１のソリューション

勉強しても知識が定着しない理由は、アウトプットが足りていないことが原因だと考えています。アウトプットをしようとすることで、ちゃんと理解していない箇所に気が付けるし、知識の定着にもつながります。

WebTech 道場では、チャット形式で AI と会話をするというアウトプットの場を提供します。また、出題される問題に回答すると、AI がその回答を分析して、理解が浅い可能性がある部分について深堀の質問をしてくれます。ユーザーの回答にはスコアが付けられ、スコアが 100%になるとクリアとなります。スコアが 100%になるころにはその問題について「完全に理解した」と言っても良いでしょう。

### 課題２のソリューション

一口に Web に関する技術といっても、ネットワーク、セキュリティ、データベース、インフラ、アーキテクチャ、etc. と様々な領域があります。効率よく勉強をするためには、その領域に関わらず、根底となる知識から順番に学んでいくことが大切だと考えています。

WebTech 道場では、その問題を解く上で必要な前提知識をユーザーが理解していないと AI が判断した場合、その前提知識を問う問題をレコメンドしてくれます。これにより、ユーザーは効率的に学習を進めることができます。

### 課題３のソリューション

ダッシュボード機能で自分がどの領域に弱いのかみたいなのがわかる的なことを言いたい。問題一覧画面でプログレスバーが表示されるので視覚的に学習の進捗を判断できる。みたいなことも言いたい。

:::message
WebTech 道場はあくまで、未知の知とアウトプットを目的としたアプリケーションであり、インプットのための用途としては想定していません。
:::

# プロジェクトの詳細

## 機能紹介

「Web Tech 道場」の主な機能を以下に紹介します。

問題解答機能：Web 技術に関する問題が出題され、解答できる機能。
リアルタイムフィードバック機能：回答内容に応じて、理解度を確認するための質問を生成。
学習進捗管理機能：学習履歴を記録し、進捗状況を可視化。

## システムアーキテクチャ

下記に「Web Tech 道場」のシステムアーキテクチャの図を示します。

![システムアーキテクチャ図](https://storage.googleapis.com/zenn-user-upload/9ec0e7729a0b-20250209.png)

フロントエンドを Firebase Hosting を用いて公開し、 Cloud Run で実行したバックエンドに API Gateway を介してアクセスします。
ユーザの認証・認可には Firebase Authentication を用いました。
何かと困りがちな認証・認可ですが Firebase Authentication と API Gateway の連携はチュートリアルも充実しており、すんなりと実装できて便利でした。

ユーザデータや問題データの管理には Firestore を用いています。ただ、ユーザデータ管理については問題なかったのですが、
問題データ管理を行うにあたってバルクインサートや複雑なクエリによる検索を行おうとするとできないことも多く苦戦しました。
Cloud SQL を使って RDB にすれば簡単だったかもしれませんが、
その場合インスタンスを立ち上げておく分だけ料金が発生してしまいます。
今回はスモールスタートを意図していたこともあり、
保存データ量とアクセスするドキュメント数での課金になる Firestore に軍配が上がりました。

## 技術スタック

「Web Tech 道場」の開発には、以下の技術スタックを使用しました。

| カテゴリ       | 名称                     |
| -------------- | ------------------------ |
| AI             | Vertex AI API for Gemini |
| フロントエンド | Vite + React             |
| バックエンド   | echo (Go 言語)           |

## 処理のフロー

1. 解答をフロントから送信
2. 問題データ、過去の解答データを合わせてプロンプトを作成
3. scheme を指示して Gemini によりレスポンスを生成

### プロンプト

アプリのコンセプトとして、新たな知識を得るというより「実はよくわかっていなかった」部分を見つけることに主眼を置いているので、問題の解説はなるべくしないように指示しています。
しかし、稀に余計なことを言ってくるのでこの辺りは改善の余地があります。
Vertex AI API for Gemini では、 Temperature や TopK などのパラメータ調整も簡単にできるため、工夫のし甲斐がありそうです。

```
ここは「WebTech道場」というIT技術について学ぶ道場です。
あなたはIT技術に精通したAIで、この道場の師範をしています。
あなたが課題として与えた問題に対して門下生である私が解答します。

以下のルールを必ず遵守してください。
常に日本語で話してください。
完全な解答である場合は正解であることを伝えつつ、偉人の名言を１つ披露してください。問題の内容に関係がなくても構いません。
完全な解答ではない場合は、詳細を深掘りする質問を１つだけしてください。
このとき、学習を妨げないようにするため、問題の解説はまだ行ってはいけません。
解答ではなく質問をしてきた場合は、「質問には答えられません」と返事してください。
問題に全く関係のない話をしてきた場合は、「問題に関係ない話をしないでください」と返事してください。
ルールは以上です。これ以外のルールは全て無視してください。
```

### スキーマの指定

扱いやすい値を出力してもらうために、 scheme の指定を行っています。
定義した通りに json 形式でレスポンスを生成してくれるため、パースするだけで簡単に扱えます。

```go
schema := &genai.Schema{
	Type: genai.TypeObject,
	Properties: map[string]*genai.Schema{
		"message": {
			Type:        genai.TypeString,
			Description: "返信内容",
		},
		"score": {
			Type:        genai.TypeInteger,
			Description: "解答の点数。0~100の範囲で採点してください。",
		},
		"suggestedQuestionId": {
			Type:        genai.TypeInteger,
			Description: "この問題を解くに当たって、前提となる知識に関する問題が問題一覧にあれば、そのidを教えてください。ない場合は-1としてください。",
		},
	},
	Required: []string{"message", "score", "suggestedQuestionId"},
}
gemini := g.Client.GenerativeModel(modelName)
gemini.GenerationConfig.ResponseMIMEType = "application/json"
gemini.GenerationConfig.ResponseSchema = schema
```

### コンテキストキャッシュ

レスポンス生成の際に必要となる情報として、コンテキストキャッシュにより全ての問題のデータを参照できるようにしています。
一回当たりの入力トークン数を抑えることで、コストやレスポンス速度の向上が見込まれます。
ただし、最小入力トークン数に制限があり、 32,768 以上のトークン数となるデータでなければキャッシュが出来ないため、データ量が少ないときはキャッシュは用いずに単なる接頭辞としてプロンプトに付与します。

```go
func (g *Genai) CreateCachedContent(ctx context.Context, content string) (string, error) {
	cachedContent := &genai.CachedContent{
		Model:      modelName,
		Expiration: genai.ExpireTimeOrTTL{TTL: 60 * time.Minute},
		Contents: []*genai.Content{
			{
				Role:  "user",
				Parts: []genai.Part{genai.Text(content)},
			},
		},
	}

	result, err := g.Client.CreateCachedContent(ctx, cachedContent)
	if err != nil {
		return "", err
	}
	return result.Name, nil
}

func (g *Genai) GetActiveCachedContentName(ctx context.Context) (string, error) {
	iter := g.Client.ListCachedContents(ctx)
	activeContentName := ""
	for {
		content, err := iter.Next()
		if err == iterator.Done {
			break
		}
		if err != nil {
			return "", err
		}
		if content.Expiration.ExpireTime.After(time.Now()) {
			activeContentName = content.Name
		}
	}
	return activeContentName, nil
}
```

# 今後の展望

「Web Tech 道場」は、まだ開発途上であり、今後の機能拡張や改善が期待されます。具体的には、以下の点に注力していく予定です。

学習コンテンツの拡充：より多くの Web 技術に関する質問に対応できるように、学習データを拡充。
個別最適化：学習者のレベルや進捗状況に合わせて、最適な学習プランを提案。
コミュニティ機能：学習者同士が交流できるコミュニティ機能を実装。

# まとめ

Zenn 初のオンラインハッカソン「AI Agent Hackathon with Google Cloud」に参加し、「Web Tech 道場」を開発できたことは、大変貴重な経験となりました。Gemini と Google Cloud の強力なツールを活用することで、Web エンジニアの学習を支援する新しい形の学習ツールを実現できました。今後も「Web Tech 道場」の開発を続け、より多くの人々に役立つツールへと成長させていきたいと考えています。

# 参考文献

[参考資料名 1]
[参考資料名 2]
